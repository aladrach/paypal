{#
/**
 * EnupalPaypal plugin for Craft CMS 3.x
 *
 * @link      https://enupal.com/
 * @copyright Copyright (c) 2018 Enupal
 */
#}

{% extends "enupal-paypal/_layouts/base" %}
{% import "_includes/forms" as forms %}
{% set crumbs = [
    { label: "Buttons"|t('enupal-paypal'), url: cpUrl('enupal-paypal/buttons') }
] %}

{% set title = 'Edit Paypal Button'|t('enupal-paypal') %}
{% set fullPageForm = true %}
{% set saveShortcutRedirect = continueEditingUrl %}

{% block actionButton %}
    <input type="hidden" name="action" value="enupal-paypal/buttons/save-button">
    {{ redirectInput('enupal-button/buttons') }}
    <input type="hidden" id="buttonId" name="id" value="{{ paypalButton.id is defined ? paypalButton.id : '' }}">

    <div class="btngroup submit first">
        <input type="submit" class="btn submit" value="{{ 'Save'|t('enupal-paypal') }}">
        {% if paypalButton.id != null %}
            <div class="btn submit menubtn"></div>
            <div class="menu">
                <ul>
                    <li><a class="formsubmit" data-redirect="{{('enupal-paypal/buttons/edit/'~paypalButton.id)|hash}}">{{ "Save and continue editing"|t('enupal-paypal') }} <span class="shortcut">âŒ˜S</span></a></li>
                </ul>
                <hr>
                <ul>
                    <li><a class="formsubmit error"
                           data-action="enupal-paypal/buttons/delete-button"
                           data-confirm='{{ "Are you sure you want to delete this Paypal Button, and all of it's data?"|t('enupal-paypal') }}'
                           data-redirect="{{ 'enupal-paypal/buttons'|hash }}">{{ "Delete"|t('enupal-paypal') }}</a>
                    </li>
                </ul>
            </div>
        {% endif %}
    </div>
{% endblock %}

{% block content %}
    <input type="hidden" name="action" value="enupal-paypal/buttons/save-button">
    <input type="hidden" name="handle" value="{{ paypalButton.handle }}">
    <input type="hidden" name="buttonId" value="{{ buttonId }}">

    {% namespace 'fields' %}
        <div id="fields">

            {{ forms.textField({
                label: "Return URL"|t('enupal-paypal'),
                instructions: "Redirect the user to this URL when the pay is successfully"|t('enupal-paypal'),
                id: 'returnUrl',
                name: 'returnUrl',
                value: paypalButton.returnUrl,
                autofocus: true,
                errors: paypalButton.getErrors('returnUrl')
            }) }}

            {{ forms.textField({
                label: "Cancel URL"|t('enupal-paypal'),
                instructions: "Redirect the user to this URL when they click the cancel button"|t('enupal-paypal'),
                id: 'cancelUrl',
                name: 'cancelUrl',
                value: paypalButton.cancelUrl,
                autofocus: true,
                errors: paypalButton.getErrors('cancelUrl')
            }) }}

        </div>
    {% endnamespace %}
{% endblock %}

{% block details %}
    {% namespace 'fields' %}
        {% include "enupal-paypal/buttons/_sidebar/settings" %}
        <hr>
    {% endnamespace %}
    {% set dateSubmitted = paypalButton.dateCreated|date('F j, Y') %}
    <div class="meta read-only">
        <div class="data">
            <h5 class="heading">{{ "Created"|t('enupal-paypal') }}</h5>
            <div class="value">{{ dateSubmitted }}</div>
        </div>
    </div>
{% endblock %}

{% do view.registerAssetBundle("enupal\\paypal\\assetbundles\\PaypalButtonAsset") %}
{% do view.registerAssetBundle("enupal\\paypal\\assetbundles\\FontAwesomeAsset") %}
{% js %}
    $(document).ready(function() {
    new EnupalPaypal();
    });
{% endjs %}
